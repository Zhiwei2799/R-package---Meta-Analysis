"0","library(stats)"
"0","library(methods)"
"0","setClass("
"0","  Class='statp',"
"0","  slots=c("
"0","    stat='numeric',"
"0","    pvalue='numeric'"
"0","  )"
"0",")"
"0",""
"0","setClass("
"0","  Class='adjp',"
"0","  slots=c("
"0","    stat='vector',"
"0","    pvalue='vector',"
"0","    adjp='vector'"
"0","  )"
"0",")"
"0",""
"0","ppool <- function(pmat,method='SD'){"
"0","  nmet <- ncol(pmat)"
"0","  pmat[pmat<1e-5] <- 1e-5"
"0","  pmat[pmat>1-1e-5] <- 1-1e-5"
"0","  if(method=='SD'){"
"0","    tf <- apply(pmat,1,max)"
"0","    cs <- qnorm(1-pmat)"
"0","    ccs <- cs[-which(tf<quantile(tf,.2)),]"
"0","    crs <- cor(ccs)"
"0","    er <- sum(crs[upper.tri(crs)])"
"0","    stat <- rowSums(cs)/sqrt(nmet+2*er)"
"0","    pv <- 1-pnorm(stat)"
"0","  }else if(method=='FD'){"
"0","    tf <- apply(pmat,1,max)"
"0","    cf <- -2*log(pmat)"
"0","    ccf <- cf[-which(tf<quantile(tf,.2)),]"
"0","    cr <- cor(ccf)"
"0","    cv <- 3.263*cr+.71*cr^2+.027*cr^3"
"0","    nmet2 <- 2*nmet"
"0","    cc <- (nmet2+sum(cv[upper.tri(cv)]))/nmet2"
"0","    ff <- nmet2^2/(nmet2+sum(cv[upper.tri(cv)]))"
"0","    stat <- rowSums(cf)/cc"
"0","    pv <- 1-pchisq(rowSums(cf)/cc,ff)"
"0","  }else if(method=='SI'){"
"0","    cs <- qnorm(1-pmat)"
"0","    stat <- rowSums(cs)/sqrt(nmet)"
"0","    pv <- 1-pnorm(stat)"
"0","  }else if(method=='FI'){"
"0","    stat <- -2*rowSums(log(pmat))"
"0","    pv <- 1-pchisq(stat,2*nmet)"
"0","  }else if(method=='MI'){"
"0","    stat <- apply(pmat,1,min)"
"0","    pv <- pbeta(stat,1,nmet)"
"0","  }else{"
"0","    stat <- apply(pmat,1,max)"
"0","    pv <- pbeta(stat,nmet,1)"
"0","  }"
"0","  pvadj <- p.adjust(pv,'BH')"
"0","  return(new('adjp',stat=stat,pvalue=pv,adjp=pvadj))"
"0","}"
